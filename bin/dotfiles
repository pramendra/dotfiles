#!/usr/bin/env bash
#
# Dotfiles CLI
# Usage: dotfiles <command>
#

DOTFILES_DIR="${DOTFILES_DIR:-$HOME/.dotfiles}"

show_help() {
  echo "Usage: dotfiles <command>"
  echo ""
  echo "Commands:"
  echo "  update     Update brew, npm, and system"
  echo "  clean      Clean caches (brew, npm)"
  echo "  macos      Apply macOS system defaults"
  echo "  edit       Open dotfiles in VS Code"
  echo "  help       Show this help"
}

cmd_update() {
  echo "üì¶ Updating system..."
  brew update && brew upgrade && brew cleanup
  npm update -g 2>/dev/null || true
  echo "‚úÖ Update complete"
}

cmd_clean() {
  echo "üßπ Cleaning..."
  brew cleanup -s
  npm cache clean --force 2>/dev/null || true
  rm -rf ~/Library/Caches/* 2>/dev/null || true
  echo "‚úÖ Clean complete"
}

cmd_macos() {
  echo "üçé Applying macOS defaults..."
  source "$DOTFILES_DIR/macos/defaults.sh"
}

cmd_edit() {
  code "$DOTFILES_DIR"
}

case "${1:-help}" in
  update) cmd_update ;;
  clean) cmd_clean ;;
  macos) cmd_macos ;;
  edit) cmd_edit ;;
  help|--help|-h) show_help ;;
  *) echo "Unknown command: $1"; show_help; exit 1 ;;
esac
