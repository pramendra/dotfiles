#!/usr/bin/env bash
set -euo pipefail

DOTFILES_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
TARGET="$HOME"

usage() {
    echo "Usage: dots {link|unlink}"
    exit 1
}

link_configs() {
    echo "üîó Linking all dotfiles modules..."
    (
        cd "$DOTFILES_DIR"
        stow --adopt --target="$HOME" zsh
        stow --adopt --target="$HOME" vscode
        stow --verbose --target="$TARGET" \
            git lang
    )

    # Verify Starship
    if ! command -v starship >/dev/null; then
        echo "‚ö†Ô∏è  Starship not found. Installing..."
        brew install starship
    else
        echo "‚úì Starship is installed"
    fi

    echo "‚ú® Configuration linked! Run: exec zsh"
}

unlink_configs() {
    echo "üóëÔ∏è Removing symlinks..."
    (
        cd "$DOTFILES_DIR"
        stow --delete --verbose --target="$TARGET" \
            zsh git lang vscode macos
    )
}

main() {
    case "${1:-}" in
        link) link_configs ;;
        unlink) unlink_configs ;;
        *) usage ;;
    esac
}

main "$@"
