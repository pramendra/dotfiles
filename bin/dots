#!/usr/bin/env bash
set -euo pipefail

cmd="${1:-help}"
case "$cmd" in
    link)
        echo "Creating config directories..."
        mkdir -p "$HOME/.config/zsh"
        mkdir -p "$HOME/.config/starship"
        
        echo "Linking configurations..."
        stow --verbose --target="$HOME" zsh
        
        echo "Verifying configuration..."
        if [ -f "$HOME/.config/zsh/.zshrc" ]; then
            chmod +x "$HOME/.config/zsh/.zshrc"
            echo "âœ“ ZSH config linked and executable"
            echo "Reloading zsh configuration..."
            source "$HOME/.config/zsh/.zshrc"
        fi
        ;;
    unlink)
        stow --delete --verbose --target="$HOME" zsh
        ;;
    *)
        echo "Usage: dots {link|unlink}"
        ;;
esac